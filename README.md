# Проект 2: Şañıraq.kz

# MVP объявлений

Продукт "Şañıraq.kz" - перспективный маркетплейс жилых помещений Казахстана.

На данном спринте мы начнем разрабатывать наш первый MVP (Minimum Valuable Product) данного сервиса.
Мы сфокусируемся на трех аспектах нашего маркетплейса - пользователи, объявления и комментарии:

- Пользователи должны иметь возможность указывать свои персональные данные, чтобы клиенты могли связаться с ними.
- Объявления - это главная ценность продукта. Пользователи должны
  иметь возможность создавать, изменять, удалять и получать свои
  объявления.
- Комментарии к объявлениям. Клиенты сервиса должны иметь возможность писать комментарий к объявлениям, чтобы оставлять
  свои отзывы.

Базовые требования к проекту:

- Использовать базу данных `sqlite`
- Наличие миграции для таблиц
- Использовать `OAuth2PasswordBearer` для авторизации

---

## ✅ Таск №1: Регистрация

Наши пользователи могут смотреть и создавать объявления. Поэтому важно, чтобы пользователи знали кто автор объявления.
Для этого нам нужно добавить регистрацию на сайт.

Ниже приведен пример запроса на API. Должен выполняться HTTP метод `POST` на роут `/auth/users/`, в который передается
JSON структура. Переданные данные должны создать нового пользователя в базе данных.

```
POST /auth/users/ HTTP/1.1
Content-Type: application/json

{
	"username": "test@gmail.com",
    "phone": "+7 700 698 5025",
	"password": "12345678",
    "name": "Далида Е.",
    "city": "Алматы"
}
```

При успешном создании, API должен возвращать HTTP код `200`.

```
HTTP/1.1 200 OK
```

## ✅ Таск №2: Логин

Для того чтобы пользователи могли пользоваться сайтом, им нужно быть авторизованными. Создайте маршрут для входа в
платформу.

Ниже приведен пример запроса на API. Должен выполняться HTTP метод `POST` на роут `/auth/users/login`, в который
передается `form-data` структура и возвращается `JWT` токен.

```
POST /auth/users/login HTTP/1.1
Content-Type: application/x-www-form-urlencoded

username=test@gmail.com&password=12345678
```

При успешном создании, API должен возвращать HTTP код `200`.

```
HTTP/1.1 200 OK

{"access_token": "<jwt_token>"}
```

## ✅ Таск №3: Изменение данных пользователя

Нужно иметь возможность авторизованному пользователю изменить свои персональные данные.

Ниже приведен пример запроса на API. Должен выполняться HTTP метод `PATCH` на роут `/auth/users/me`,
в который передается JSON структура. Переданные данные должны сохраняться пользователю, который делает запрос.

Чтобы узнать какой пользователь, нужно извлечь id пользователя из токена.

```
PATCH /auth/users/me HTTP/1.1
Authorization: Bearer {token}

{
    "phone": "+7 700 698 5025",
    "name": "Далида Е.",
    "city": "Алматы"
}
```

При успешном сохранении, API должен возвращать HTTP код `200`.

```
HTTP/1.1 200 OK
```

## ✅ Таск №4: Получение данных пользователя

Нужно предоставить возможность авторизованному пользователю получать свои персональные данные.

Пример запроса на API: должен выполняться HTTP метод `GET` на роут `/auth/users/me`.

Аутентификация происходит через заголовок `Authorization`, где `{token}` - токен авторизованного пользователя.

```
GET /auth/users/me HTTP/1.1
Authorization: Bearer {token}
```

При успешном выполнении запроса, API должен возвращать HTTP код `200`, а в теле ответа JSON структура с данными
пользователя.

```
HTTP/1.1 200 OK

{
    "id": "{user_id}",
    "username": "{почта текущего пользователя}",
    "phone": "+7 700 698 5025",
    "name": "Далида Е.",
    "city": "Алматы"
}
```

## ✅ Таск №5: Создание объявления

Пользователи должны иметь возможность создавать новые объявления.

Важно, чтобы созданное объявление закреплялось за пользователем.

Пример запроса на API: должен выполняться HTTP метод `POST` на роут `/shanyraks/`, в который передается JSON структура с
данными объявления.

```
POST /shanyraks/ HTTP/1.1
Authorization: Bearer {token}

{
    "type": "rent",
    "price": 150000,
    "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь",
    "area": 46.5,
    "rooms_count": 2,
    "description": "Продается 1.5 комнатная квартира. ЖК расположен на правом берегу, не далеко от левого берега.\nДом расположен в хорошей локации. Рядом находятся мечеть Хазрет Султан, Пирамида, аллея тысячелетия, и многое другое.\nдвор закрытый, садик во дворе дома, школы в пешей доступности"
}
```

При успешном создании объявления, API должен возвращать HTTP код `200` и JSON структура с `id` нового объявления.

```
HTTP/1.1 200 OK

{
    "id": "1"
}
```

## ✅ Таск №6: Получение объявления

Пользователи должны иметь возможность просматривать детали своих объявлений.

Пример запроса на API: должен выполняться HTTP метод `GET` на роут `/shanyraks/{id}`, где `{id}` - идентификатор
объявления.

```
GET /shanyraks/{id} HTTP/1.1
```

При успешном выполнении запроса, API должен возвращать HTTP код `200` и JSON структура с данными объявления.

```
HTTP/1.1 200 OK

{
    "id": "1",
    "type": "rent",
    "price": 150000,
    "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь",
    "area": 46.5,
    "rooms_count": 2,
    "description": "Продается 1.5 комнатная квартира. ЖК расположен на правом берегу, не далеко от левого берега.\nДом расположен в хорошей локации. Рядом находятся мечеть Хазрет Султан, Пирамида, аллея тысячелетия, и многое другое.\nдвор закрытый, садик во дворе дома, школы в пешей доступности",
    "user_id": "{user_id пользователя создавшего объявление}"
}
```

## ✅ Таск №7: Изменение объявления

Пользователи должны иметь возможность изменять данные своих объявлений.

Пример запроса на API: должен выполняться HTTP метод `PATCH` на роут `/shanyraks/{id}`, в который передается JSON
структура с новыми данными объявления.

`{id}` - идентификатор объявления.

```
PATCH /shanyraks/{id} HTTP/1.1
Authorization: Bearer {token}

{
    "type": "rent",
    "price": 250000,
    "address": "Астана, Алматы р-н, ул. Нажимеденова, 17",
    "area": 38.5,
    "rooms_count": 2,
    "description": "СРОЧНО!!!\nПродается 1.5 комнатная квартира. ЖК расположен на правом берегу, не далеко от левого берега.\nДом расположен в хорошей локации. Рядом находятся мечеть Хазрет Султан, Пирамида, аллея тысячелетия, и многое другое.\nдвор закрытый, садик во дворе дома, школы в пешей доступности"
}
```

При успешном изменении данных объявления, API должен возвращать HTTP код `200`.

```
HTTP/1.1 200 OK
```

## ✅ Таск №8: Удаление объявления

Пользователи должны иметь возможность удалять свои объявления.

Пример запроса на API: должен выполняться HTTP метод `DELETE` на роут `/shanyraks/{id}`, где `{id}` - идентификатор
объявления.

```
DELETE /shanyraks/{id} HTTP/1.1
Authorization: Bearer {token}
```

При успешном удалении объявления, API должен возвращать HTTP код `200`.

```
HTTP/1.1 200 OK
```

## ✅ Таск №9: Добавление комментария к объявлению

Пользователи должны иметь возможность оставлять комментарии к объявлениям.

Важно, чтобы созданный комментарий закреплялся за пользователем.

Пример запроса на API: должен выполняться HTTP метод `POST` на роут `/shanyraks/{id}/comments`, где `{id}` -
идентификатор объявления.

```
POST /shanyraks/{id}/comments HTTP/1.1
Authorization: Bearer {token}

{
    "content": "Очень понравилось тут жить! Соседи тихие, автобусные остановки рядом, школа рядом. Дети довольны! 🥰"
}
```

При успешном добавлении комментария, API должен возвращать HTTP код `200`.

```
HTTP/1.1 200 OK
```

## ✅ Таск №10: Получение списка комментариев объявления

Пользователи должны иметь возможность просматривать список комментариев к объявлениям.

Пример запроса на API: должен выполняться HTTP метод `GET` на роут `/shanyraks/{id}/comments`, где `{id}` -
идентификатор объявления.

```
GET /shanyraks/{id}/comments HTTP/1.1
```

При успешном выполнении запроса, API должен возвращать HTTP код `200` и JSON структура с массивом комментариев.

```
HTTP/1.1 200 OK

{
    "comments": [
        {
            "id": "{comment_id}",
						"content": "Очень понравилось тут жить! Соседи тихие, автобусные остановки рядом, школа рядом. Дети довольны! 🥰",
						"created_at": "{время и дата создания}",
            "author_id": "{user_id пользователя который оставил коммент}"
        },
        {
            "id": "{comment_id}",
						"content": "Очень шумный двор! 😡\nКуча детей играют в футбол до поздна! Много посуточных квартир, поэтому всю ночь ходят пьянные парочки. Везде мусор кидают дети.",
						"created_at": "{время и дата создания}",
            "author_id": "{user_id пользователя который оставил коммент}"
        }
    ]
}
```

## ✅ Таск №11: Изменение текста комментария

Пользователи должны иметь возможность изменять текст своего комментария.

Пример запроса на API: должен выполняться HTTP метод `PATCH` на роут `/shanyraks/{id}/comments/{comment_id}`,
где `{id}` - идентификатор объявления, `{comment_id}` - идентификатор комментария.

```
PATCH /shanyraks/{id}/comments/{comment_id} HTTP/1.1
Authorization: Bearer {token}

{
    "content": "Живу здесь с момента постройки, все устраивает, самое главное распоряжение, тепло, кск хорошо и вовремя реагирует на заявку, парковка огромная, школы, садики, ТРЦ, крупные магазины все рядом. Единственный минус большое количество квартирантов."
}
```

При успешном изменении комментария, API должен возвращать HTTP код `200`.

```
HTTP/1.1 200 OK
```

## ✅ Таск №12: Удаление комментария

Пользователи должны иметь возможность удалять свои комментарии.

Пример запроса на API: должен выполняться HTTP метод `DELETE` на роут `/shanyraks/{id}/comments/{comment_id}`,
где `{id}` - идентификатор объявления, `{comment_id}` - идентификатор комментария.

```
DELETE /shanyraks/{id}/comments/{comment_id} HTTP/1.1
Authorization: Bearer {token}
```

При успешном удалении комментария, API должен возвращать HTTP код `200`.

```
HTTP/1.1 200 OK
```

## 💎 Таск №13: Получение объявления - кол-во комментариев

При получении детальной информации об объявлении, было бы полезно знать сколько комментариев содержится в объявлении.

Пример запроса на API: должен выполняться HTTP метод `GET` на роут `/shanyraks/{id}`, где `{id}` - идентификатор
объявления.

```
GET /shanyraks/{id} HTTP/1.1
```

При успешном выполнении запроса, API должен возвращать HTTP код `200` и JSON структура с данными объявления.

```
HTTP/1.1 200 OK

{
    "id": "1",
    "type": "rent",
    "price": 150000,
    "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь",
    "area": 46.5,
    "rooms_count": 2,
    "description": "Продается 1.5 комнатная квартира. ЖК расположен на правом берегу, не далеко от левого берега.\nДом расположен в хорошей локации. Рядом находятся мечеть Хазрет Султан, Пирамида, аллея тысячелетия, и многое другое.\nдвор закрытый, садик во дворе дома, школы в пешей доступности",
    "user_id": "{user_id пользователя создавшего объявление}",
		"total_comments": 12 <---- новое поле
}
```

## 💎 Таск №14: Deploy

Разверните наше приложение на одном из хостинг-провайдеров:

- aws.com
- railway.app
- render.com




# Проект 3: Şañıraq.kz p.2

# MVP объявлений

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/cb3cd617-dcba-4080-b153-57789faf9237/Untitled.png)

Проект "[Şañıraq.kz](http://xn--araq-gqa89amk.kz)" стремится стать лидером на рынке недвижимости, обеспечивая пользователям простой и удобный доступ к объявлениям.

На данном спринте мы поработаем над добавлением новой фичи и также возьмем пару задач из беклога:

- Избранные объявления. Пользователи должны иметь возможность сохранить некоторые объявления, чтобы вернуться к ним позже.
- Разработка списка объявлений: пользователи смогут легко просматривать все доступные предложения.
- Поиск и фильтрация объявлений: будут созданы инструменты для быстрого нахождения нужных объявлений.

Базовые требования к проекту:

- Использовать базу данных `sqlite`
- Наличие миграции для таблиц
- Использовать `OAuth2PasswordBearer` для авторизации

---

## ✅ Таск №1: Ошибка аутентификации

Приведите наши текущие маршруты в соответствие с протоколом HTTP в части аутентификации:

- `PATCH /auth/users/me`
- `GET /auth/users/me`
- `POST /shanyraks/`
- `PATCH /shanyraks/{id}`
- `DELETE /shanyraks/{id}`
- `POST /shanyraks/{id}/comments`
- `PATCH /shanyraks/{id}/comments/{comment_id}`
- `DELETE /shanyraks/{id}/comments/{comment_id}`

Маршрут, который требует аутентификации, должен возвращать соответсвующее сообщение об ошибке следующим образом. Пример, делается запрос без авторизации:

```
GET /auth/users/me HTTP/1.1
```

```
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer
```

## ✅ Таск №2: Права на изменение и удаление постов

Пользователи должны иметь право на изменение и удаление только тех постов, которые они создали. Они не должны иметь права на изменение и удаление чужих постов. Измените данные роуты, чтобы только автор смог их вызывать:

- `PATCH /shanyraks/{id}`
- `DELETE /shanyraks/{id}`

```
DELETE /shanyraks/{id} HTTP/1.1
Authorization: Bearer <token not author>
```

```
HTTP/1.1 403 Forbidden
```

## ✅ Таск №3: Права на изменение и удаление комментариев

Пользователи должны иметь право на изменение и удаление только тех комментариев, которые они создали. Они не должны иметь права на изменение и удаление чужих комментариев.

Измените данные роуты, чтобы только автор комментария смог их вызывать:

- `PATCH /shanyraks/{id}/comments/{comment_id}`
- `DELETE /shanyraks/{id}/comments/{comment_id}`

Также, измените данные роуты, чтобы автор поста мог удалять комментарии:

- `DELETE /shanyraks/{id}/comments/{comment_id}`

```
DELETE /shanyraks/{id}/comments/{comment_id} HTTP/1.1
Authorization: Bearer <token not author>
```

```
HTTP/1.1 403 Forbidden
```

## ✅ Таск №4: Добавление в избранное

Пользователи должны иметь возможность добавлять объявления в избранное. Для этого предлагается создать новый роут `POST /auth/users/favorites/shanyraks/{id}`, где `{id}` - идентификатор объявления.

```
POST /auth/users/favorites/shanyraks/{id} HTTP/1.1
Authorization: Bearer {token}
```

```
HTTP/1.1 200 OK
```

## ✅ Таск №5: Получение списка избранных

Также пользователи должны иметь возможность просматривать свой список избранных объявлений. Создать роут `GET /auth/users/favorites/shanyraks` который вернет список избранных объявлений пользователя.

```
GET /auth/users/favorites/shanyraks HTTP/1.1
Authorization: Bearer {token}
```

```
HTTP/1.1 200 OK

{
    "shanyraks": [
        {
            "_id": "{shanyrak_id1}",
            "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь"
        },
        {
            "_id": "{shanyrak_id2}",
            "address": "{address2}"
        }
        "..."
    ]
}
```

## ✅ Таск №6: Удаление из избранного

Пользователь должен иметь возможность удалить объявление из списка избранных. Создать роут `DELETE /auth/users/favorites/shanyraks/{id}` для удаления объявления из списка избранных.

```
DELETE /auth/users/favorites/shanyraks/{id} HTTP/1.1
Authorization: Bearer {token}
```

```
HTTP/1.1 200 OK
```

## ✅ Таск №7: Поиск и пагинация

Нужно реализовать поиск и пагинацию по объявлениям. 
Реализуйте роут, который поддерживает следующие параметры запроса (query
 parameters):

| Параметр | Описание |
| --- | --- |
| limit | Кол-во записей для отображения на странице |
| offset | Точка начала отображения в наборе данных |
| type | Тип объявления - продажа (sell) или аренда (rent) |
| rooms_count | Кол-во комнат |
| price_from | Стоимость от |
| price_until | Стоимость до |

Каждый параметр, кроме `limit` и `offset`, опциональный. Если не указывать никакого параметра поиска, то роут должен вернуть все объявления.

Объявления должны быть отсортированы по убыванию даты создания.

Для каждого объявления вернуть следующий список полей:

- `id`
- `type`
- `price`
- `address`
- `area`
- `rooms_count`
- `location`

В ответе должно присутсвовать поле `total`, который указывает сколько всего объявлений по данному фильтру.